<html>
<head>
  <meta charset="utf-8">
  <title>学生信息管理</title>
  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
</head>


<body>
<div class="container">
  <h1 class="text-center">学生信息管理</h1>



  <form id="search-form" class="form-inline">
    <div class="form-group">
      <label for="college">学院</label>
      <input type="text" class="form-control" id="college" name="college" placeholder="请输入学院">
    </div>
    <div class="form-group">
      <label for="major">专业</label>
      <input type="text" class="form-control" id="major" name="major" placeholder="请输入专业">
    </div>
    <div class="form-group">
      <label for="name">姓名</label>
      <input type="text" class="form-control" id="name" name="name" placeholder="请输入姓名">
    </div>
    <div class="form-group">
      <label for="sid">学号</label>
      <input type="text" class="form-control" id="sid" name="sid" placeholder="请输入学号">
    </div>
    <div class="form-group">
      <label for="phone">手机号</label>
      <input type="text" class="form-control" id="phone" name="phone" placeholder="请输入手机号">
    </div>
    <button type="submit" class="btn btn-primary">搜索</button>
  </form>
  <button type="button" class="btn btn-primary" onclick="window.location='DataManage.html'">返回</button>
  <!-- 添加按钮 -->
  <button id="add-btn" class="btn btn-success">添加</button>
  <!-- 上传按钮 -->
  <button id="upload-btn" class="btn btn-info">上传</button>
  <!-- 显示表格 -->
  <table id="show-table" class="table table-striped table-bordered table-hover">
    <thead>
    <tr>
      <th>学号</th>
      <th>姓名</th>
      <th>专业</th>
      <th>学院</th>
      <th>性别</th>
      <th>密码</th>
      <th>手机号</th>
      <th>操作</th>
    </tr>
    </thead>
    <tbody></tbody>
  </table>





  <div id="edit-modal" class="modal fade">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">编辑学生信息</h4>
          <button type = "button" class = "close" data-dismiss = "modal">×</button>
        </div>


        <div class = "modal-body">
          <!-- 编辑表单 -->
          <form id = "edit-form" class = "form-horizontal">


            <!-- 学号 -->
            <div class = "form-group row">
              <label for = "edit-sid" class = "col-sm-2 col-form-label">学号</label>
              <div class = "col-sm-10">
                <input type = "text" readonly class = "form-control-plaintext" id = "edit-sid">
              </div>
            </div>

            <!-- 姓名 -->
            <div class = "form-group row">
              <label for = "edit-name" class = "col-sm-2 col-form-label">姓名</label>
              <div class = "col-sm-10">
                <input type = "text" class = "form-control" id = "edit-name">
              </div>
            </div>

            <!-- 专业 -->
            <div class = "form-group row">
              <label for = "edit-major" class = "col-sm-2 col-form-label">专业</label>
              <div class = "col-sm-10">
                <input type = "text" class = "form-control" id = "edit-major">
              </div>
            </div>

            <!-- 学院 -->
            <div class = "form-group row">
              <label for = "edit-college" class = "col-sm-2 col-form-label">学院</label>
              <div class = "col-sm-10">
                <input type = "text" class = "form-control" id = "edit-college">
              </div>
            </div>

            <!-- 性别 -->
            <div class = "form-group row">
              <label for = "edit-sex" class = "col-sm-2 col-form-label">性别</label>
              <div class = "col-sm-10">
                <input type = "text" class = "form-control" id = "edit-sex">
              </div>
            </div>

            <!-- 密码 -->
            <div class = "form-group row">
              <label for = "edit-passwd" class = "col-sm-2 col-form-label">密码</label>
              <div class = "col-sm-10">
                <input type = "text" class = "form-control" id = "edit-passwd">
              </div>
            </div>

            <!-- 手机号 -->
            <div class = "form-group row">
              <label for = "edit-phone" class = "col-sm-2 col-form-label">手机号</label>
              <div class = "col-sm-10">
                <input type = "text" class = "form-control" id = "edit-phone">
              </div>
            </div>
          </form>
        </div>


        <div class="modal-footer">

          <button id="confirm-btn" type="button" class="btn btn-primary">确认</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>

        </div>
      </div>
    </div>
  </div>



  <div id="add-modal" class="modal fade">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">添加学生信息</h4>
          <button type="button" class="close" data-dismiss="modal">×</button>
        </div>

        <div class="modal-body">
          <form id="add-form" class="form-horizontal">
            <!-- 学号 -->
            <div class="form-group row">
              <label for="add-sid" class="col-sm-2 col-form-label">学号</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="add-sid">
              </div>
            </div>

            <!-- 姓名 -->
            <div class="form-group row">
              <label for="add-name" class="col-sm-2 col-form-label">姓名</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="add-name">
              </div>
            </div>

            <!-- 专业 -->
            <div class="form-group row">
              <label for="add-major" class="col-sm-2 col-form-label">专业</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="add-major">
              </div>
            </div>

            <div class="form-group row">
              <label for="add-college" class="col-sm-2 col-form-label">学院</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="add-college">
              </div>
            </div>

            <!-- 性别 -->
            <div class="form-group row">
              <label for="add-sex" class="col-sm-2 col-form-label">性别</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="add-sex">
              </div>
            </div>

            <!-- 密码 -->
            <div class="form-group row">
              <label for="add-passwd" class="col-sm-2 col-form-label">密码</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="add-passwd">
              </div>
            </div>

            <!-- 手机号 -->
            <div class="form-group row">
              <label for="add-phone" class="col-sm-2 col-form-label">手机号</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="add-phone">
              </div>
            </div>
          </form>
        </div>



        <div class="modal-footer">
          <button id="add-confirm-btn" type="button" class="btn btn-primary">确认</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
        </div>
      </div>
    </div>
  </div>




  <!-- 上传 -->
  <div id="upload-modal" class="modal fade">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">上传学生信息</h4>
          <button type = "button" class = "close" data-dismiss = "modal">×</button>
        </div>

        <div class = "modal-body">
          <form id = "upload-form" enctype = "multipart/form-data">


            <!-- 文件选择 -->
            <input type = "file" name = "file" id = "file" accept = ".csv,.xlsx,.xls">
          </form>
        </div>

        <div class="modal-footer">
          <!-- 确认按钮 -->
          <button id="upload-confirm-btn" type="button" class="btn btn-primary">确认</button>
          <!-- 取消按钮 -->
          <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
        </div>
      </div>
    </div>
  </div>







  <script>//JS部分
    //存储编辑的学生对象
    var currentStudent = null;

    function createTableRow(student) {
      var tr = $("<tr></tr>");
      var sidTd = $("<td></td>").text(student.sid);
      var nameTd = $("<td></td>").text(student.name);
      var majorTd = $("<td></td>").text(student.major);
      var collegeTd = $("<td></td>").text(student.college);
      var sexTd = $("<td></td>").text(student.sex);
      var passwdTd = $("<td></td>").text(student.passwd);
      var phoneTd = $("<td></td>").text(student.phone);
      var editBtn = $("<button></button>").addClass("btn btn-warning").text("编辑");
      var deleteBtn = $("<button></button>").addClass("btn btn-danger").text("删除");
      var opTd = $("<td></td>").append(editBtn).append(deleteBtn);
      tr.append(sidTd).append(nameTd).append(majorTd).append(collegeTd).append(sexTd).append(passwdTd).append(phoneTd).append(opTd);
      return tr;
    }

    // 填充编辑表单
    function fillEditForm(student) {
      var editSid = $("#edit-sid");
      var editName = $("#edit-name");
      var editMajor = $("#edit-major");
      var editCollege = $("#edit-college");
      var editSex = $("#edit-sex");
      var editPasswd = $("#edit-passwd");
      var editPhone = $("#edit-phone");

      editSid.val(student.sid);
      editName.val(student.name);
      editMajor.val(student.major);
      editCollege.val(student.college);
      editSex.val(student.sex);
      editPasswd.val(student.passwd);
      editPhone.val(student.phone);
    }


//接口部分，来自bing
    // 定义一个函数，用于根据搜索表单的值发送Ajax请求，并显示返回的数据
    function searchAndShow() {
      // 获取搜索表单的元素
      var searchForm = $("#search-form");
      // 获取搜索表单的序列化数据
      var searchData = searchForm.serialize();
      // 发送Ajax请求，传递搜索表单的数据
      $.ajax({
        url: "/searchStudent",
        type: "GET",
        data: searchData,
        dataType: "json",
        success: function(data) {
          // 如果返回的数据是一个数组，说明查询成功
          if (Array.isArray(data)) {
            // 获取显示表格的tbody元素
            var showTbody = $("#show-table tbody");
            // 清空tbody中的内容
            showTbody.empty();
            // 遍历返回的数据数组，对每个学生对象进行处理
            for (var i = 0; i < data.length; i++) {
              // 获取当前的学生对象
              var student = data[i];
              // 调用函数，根据学生对象生成表格的一行
              var tr = createTableRow(student);
              // 将生成的tr添加到tbody中
              showTbody.append(tr);
            }
          } else {
            // 如果返回的数据不是一个数组，说明查询失败，弹出提示信息
            alert(data.message || "查询失败，请重试！");
          }
        },
        error: function() {
          // 如果请求失败，弹出提示信息
          alert("请求失败，请重试！");
        }
      });
    }


    // 当文档加载完成后，执行以下代码
    $(document).ready(function() {
      // 绑定搜索表单的提交事件
      $("#search-form").submit(function(event) {
        // 阻止表单的默认提交行为
        event.preventDefault();
        // 调用函数，根据搜索表单的值发送Ajax请求，并显示返回的数据
        searchAndShow();
      });





      $("#add-btn").click(function() {
        $("#add-modal").modal("show");
      });
      $("#add-confirm-btn").click(function() {
        var addForm = $("#add-form");
        var addData = addForm.serialize();





        // 发送Ajax请求，传递添加表单的数据
        $.ajax({
          url: "/addStudent",
          type: "POST",
          data: addData,
          dataType: "json",
          success: function(data) {
            if (typeof data === "object") {
              $("#add-modal").modal("hide");
              alert(data.message || "添加成功！");
              // 调用函数，根据搜索表单的值发送Ajax请求，并显示返回的数据
              searchAndShow();
            } else {
              alert(data.message || "添加失败，请重试！");
            }
          },
          error: function() {
            alert("请求失败，请重试！");
          }
        });
      });

// 绑定上传按钮
      $("#upload-btn").click(function() {
        $("#upload-modal").modal("show");
      });

      $("#upload-confirm-btn").click(function() {
        var uploadForm = $("#upload-form")[0];
        var uploadData = new FormData(uploadForm);


        // 发送Ajax请求，传递上传表单的数据
        $.ajax({
          url: "/uploadStudent",
          type: "POST",
          data: uploadData,
          dataType: "json",
          contentType: false,
          processData: false,
          success: function(data) {
            if (typeof data === "object") {
              $("#upload-modal").modal("hide");
              alert(data.message || "上传成功！");
              searchAndShow();
            } else {
              alert(data.message || "上传失败，请重试！");
            }
          },
          error: function() {
            alert("请求失败，请重试！");
          }
        });
      });



      $("#show-table tbody").on("click", "button.btn-warning", function() {

        var tr = $(this).closest("tr");
        var student = {};
        student.sid = tr.children().eq(0).text();
        student.name = tr.children().eq(1).text();
        student.major = tr.children().eq(2).text();
        student.college = tr.children().eq(3).text();
        student.sex = tr.children().eq(4).text();
        student.passwd = tr.children().eq(5).text();
        student.phone = tr.children().eq(6).text();
        currentStudent = student;
        fillEditForm(student);


        $("#edit-modal").modal("show");
      });


      $("#show-table tbody").on("click", "button.btn-danger", function() {

        var tr = $(this).closest("tr");
        var sid = tr.children().eq(0).text();
        var result = confirm("您确定要删除学号为" + sid + "的学生吗？");
        if (result) {


          // 发送Ajax请求，传递要删除的学号
          $.ajax({
            url: "/deleteStudent",
            type: "POST",
            data: {sid: sid},
            dataType: "json",
            success: function(data) {
              // 如果返回的数据是一个对象，说明删除成功
              if (typeof data === "object") {
                // 弹出提示信息
                alert(data.message || "删除成功！");
                // 调用函数，根据搜索表单的值发送Ajax请求，并显示返回的数据
                searchAndShow();
              } else {
                // 如果返回的数据不是一个对象，说明删除失败，弹出提示信息
                alert(data.message || "删除失败，请重试！");
              }
            },
            error: function() {
              // 如果请求失败，弹出提示信息
              alert("请求失败，请重试！");
            }
          });
        }
      });


      $("#confirm-btn").click(function() {
        var editForm = $("#edit-form");

        var editData = editForm.serialize();



        // 发送Ajax请求，传递编辑表单的数据
        $.ajax({
          url: "/changeStudent",
          type: "POST",
          data: editData,
          dataType: "json",
          success: function(data) {
            if (typeof data === "object") {
              $("#edit-modal").modal("hide");
              alert(data.message || "修改成功！");
              searchAndShow();
            } else {
              alert(data.message || "修改失败，请重试！");
            }
          },


          error: function() {
            // 如果请求失败，弹出提示信息
            alert("请求失败，请重试！");
          }
        });
      });
    });
  </script>
</body>
</html>

